This is the task at hand. As we move forward we will make COMPLETION NOTES on each steps
Part 1: Technical Recap of Geotour Crete for Theme Redevelopment
System Core: The Geotour Crete portal is a bespoke WordPress application built to catalogue and present Crete's points of interest. Its architecture is deeply integrated with its content structure.
Primary Data Structure - listing Custom Post Type (CPT): The platform's foundation is the listing CPT. Its power lies in its complex classification system and the associated conditional metadata.
•	Taxonomies:
1.	Typology (taxonomy=listing-category): A hierarchical, multi-select taxonomy defining the listing's nature (e.g., Archaeological Site, Village). Key terms in this taxonomy have icon and hover_icon metadata, which are essential for custom marker rendering on Leaflet.js maps.
2.	Geography (taxonomy=listing-region): A hierarchical taxonomy for administrative location, enabling spatial filtering.
3.	Grouping (taxonomy=listing-tag): A non-hierarchical taxonomy for creating thematic collections, often visualized as dedicated map pages.
•	Critical Functionality - Existing Category-Dependent Custom Fields: The most significant technical challenge lies with the custom fields (Metaboxes). This data already exists in the wp_postmeta table. The current theme contains the logic that conditionally displays these fields in the WordPress admin editor and renders them on the front-end based on the assigned listing-category. With the old theme disabled, this logic vanishes, making the existing data invisible and uneditable in the admin. The new theme's primary task is to re-implement this conditional logic for both front-end display and back-end administration in a modern, maintainable way.
Core Technology & User Experience:
•	Spatial Data Visualization with Leaflet.js: The platform is fundamentally a spatial application. All listings are geolocated and posts, people, old photos are linked to these listings by having field that links them. The new theme will use Leaflet.js as the core library for all 2D map visualizations. This requires dynamically generating GeoJSON data from WordPress queries and using the listing-category metadata to render custom markers on the interactive maps.
•	Integration with External Tools: The theme must continue to provide seamless integration points for the existing Pano2VR virtual tours and the CesiumJS 3D map, embedding or linking to them from listing pages to preserve the platform's multi-perspective exploration ethos.
Scope of Work Exclusion: Functionalities for Events, People, Custom Maps, and Old Photographs are handled by dedicated plugins. The theme will only provide CSS styling for their front-end output.
________________________________________
Part 2: Goal of the Theme Development Project
The central objective is to architect and develop a new, mobile-first custom WordPress theme for Geotour Crete, built on principles of high performance, security, and modern code standards. The project's core technical task is to re-implement the display and management logic for the existing listing content type. This involves creating a robust system that can conditionally render the pre-existing custom field data on the front-end and, crucially, re-enable the conditional editing of this data within the WordPress admin. The project will leverage Leaflet.js for all map functionalities. The final product will be a lightweight, maintainable, and elegant theme that dramatically improves the mobile user experience while building a future-proof foundation for the Geotour Crete platform.
________________________________________
Part 3: AI-Assisted Development Plan
This plan outlines the procedural steps for an AI model to assist in the theme's creation, focusing on re-implementing logic rather than data migration.
Phase 1: Environment and Foundation Setup
•	1.1. Project Initialization: 
o	1.1.1. Initialize a Git repository.
o	1.1.2. Set up a local WordPress development environment with a clone of the live site's database to ensure access to all existing content and metadata.
o	1.1.3. Create the new theme directory (/geotour-mobile-first/) with essential files: style.css, index.php, functions.php.
•	1.2. Build Process Configuration: 
o	1.2.1. Configure npm and a bundler like webpack or Vite for SASS/SCSS compilation, JavaScript bundling (ES6+), asset minification, and image optimization.
Phase 2: Legacy System Analysis & Replication Blueprint
•	2.1. Analyze Old Theme & Database: 
o	2.1.1. Ingest and parse the old theme's PHP files to identify the custom field implementation.
o	2.1.2. Concurrently, query the wp_postmeta table for a listing post. Extract a definitive list of all meta_keys used.
o	2.1.3. Create a "Replication Blueprint": a structured document (e.g., JSON or YAML) that maps each meta_key to its corresponding listing-category, its data type (text, WYSIWYG, etc.), and its front-end label. This blueprint is the guide for the new implementation.
o	2.1.4. Verify the storage location of listing-category icon metadata (likely wp_termmeta).
Phase 3: New Theme Architecture & Admin Field Management
•	3.1. Core Functionality Plugin: 
o	3.1.1. Create a custom plugin (geotour-core-functionality) to house the CPT and taxonomy registrations. This ensures site structure persists independently of the theme.
•	3.2. Re-implement Admin Fields with ACF: 
o	3.2.1. Install Advanced Custom Fields Pro. The goal is to use ACF to manage the existing meta keys without altering them.
o	3.2.2. Programmatically generate ACF Field Groups using PHP (acf_add_local_field_group).
o	3.2.3. For each field group, set its location rules to show conditionally based on the listing-category term, mirroring the old logic discovered in Phase 2.
o	3.2.4. Crucially, for each field within a group, manually set its name property to match the corresponding meta_key from the database (e.g., 'name' => 'old_meta_key_for_address',). This instructs ACF to read from and save to the existing meta_key, effectively re-linking the admin UI to the existing data.
o	3.2.5. Create an ACF Field Group for the listing-category taxonomy to manage the icon and hover_icon fields, linking them to their existing term meta keys.
Phase 4: Template Development & Leaflet.js Map Integration
•	4.1. Core Templates (Mobile-First): 
o	4.1.1. Develop a responsive header.php, footer.php, and touch-friendly navigation menu.
o	4.1.2. Build clean single.php and page.php templates compatible with the block editor.
•	4.2. listing CPT Templates: 
o	4.2.1. Create single-listing.php. Use ACF's get_field('meta_key_name', $post_id) to fetch and display the data from the existing custom fields.
o	4.2.2. Develop archive templates: archive-listing.php, taxonomy-listing-category.php, etc.
•	4.3. Leaflet.js Map Implementation: 
o	4.3.1. Enqueue the Leaflet.js library and a custom map script (leaflet-init.js) conditionally on pages requiring a map.
o	4.3.2. In the map-enabled templates (e.g., archive-listing.php), query for the relevant listings.
o	4.3.3. In PHP, construct a GeoJSON Feature Collection. Each feature's properties must include title, permalink, and iconUrl. Retrieve the iconUrl by getting the listing's primary listing-category term and then fetching its icon field via get_field('icon', 'listing-category_' . $term_id).
o	4.3.4. Use wp_localize_script to pass the GeoJSON object to leaflet-init.js.
o	4.3.5. The JavaScript will initialize the Leaflet map, parse the GeoJSON, and create L.marker instances with custom icons (L.icon) and popups.
Phase 5: Finalization, Testing, and Deployment
•	5.1. Audit and Refinement: 
o	5.1.1. Conduct a full security audit (escaping, sanitization) and performance review (asset minification, query optimization).
•	5.2. Testing: 
o	5.2.1. Perform rigorous cross-browser and mobile device testing.
o	5.2.2. Verify in the WordPress admin that editing a listing in a specific category shows the correct fields and that the data persists on save.
•	5.3. Deployment: 
o	5.3.1. Deploy the new theme and functionality plugin to a staging environment.
o	5.3.2. Thoroughly test all functionality on the staging site. Confirm that all existing data is displayed correctly on the front-end and is editable in the back-end.
o	5.3.3. Following successful verification, deploy to the live production server.
(Side Note: The described approach avoids data migration by re-mapping the admin interface to existing data structures. Should any targeted data transformation be required during the project—for instance, to standardize a specific field's format across all entries—a dedicated, one-time WP-CLI script can be developed to handle that specific task as needed.)

